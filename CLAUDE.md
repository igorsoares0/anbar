# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Development Commands

```bash
# Start development server
npm run dev

# Build the application
npm run build

# Start production server
npm start

# Run linting
npm run lint

# Database setup (run after fresh clone or schema changes)
# Requires PostgreSQL database and DATABASE_URL environment variable
npm run setup

# Deploy to Shopify
npm run deploy

# GraphQL code generation
npm run graphql-codegen
```

## Architecture Overview

This is a Shopify announcement bar app built with Remix framework that includes:

- **Main App**: Remix-based web application in `/app` directory with announcement bar management
- **Theme Integration**: App embed blocks and app blocks for displaying announcement bars
- **Database**: Prisma ORM with PostgreSQL for session and announcement bar storage
- **Authentication**: Shopify App Bridge with OAuth flow

### Key Files

- `app/shopify.server.ts` - Main Shopify app configuration and authentication setup
- `app/db.server.ts` - Prisma database client
- `prisma/schema.prisma` - Database schema (Session + AnnouncementBar models)
- `shopify.app.toml` - App configuration with scopes (`write_products`) and webhooks
- `extensions/anbar/shopify.extension.toml` - Theme extension configuration

### Directory Structure

```
app/
├── routes/          # Remix routes
│   ├── app._index.tsx              # Main app page with product creation demo
│   ├── app.announcements._index.tsx # Announcement bars list page
│   ├── app.announcements.new.tsx   # Create announcement bar page
│   ├── app.announcements.$id.tsx   # Edit announcement bar page
│   ├── api.announcement-bars.tsx   # API endpoint for theme integration
│   ├── app.additional.tsx          # Additional app page
│   ├── webhooks/                   # Webhook handlers
│   └── auth/                       # Authentication routes
├── shopify.server.ts    # Shopify configuration
└── db.server.ts        # Database client

extensions/anbar/        # Theme extension
├── blocks/             # App blocks
│   └── announcement_bar.liquid     # Manual positioning with ID
├── app_embeds/         # App embeds
│   └── announcement_bars.liquid    # Automatic display
└── locales/            # Translation files
```

### GraphQL Configuration

Uses `@shopify/api-codegen-preset` for Admin API type generation. Configuration in `.graphqlrc.ts` automatically detects extensions with GraphQL schemas.

### Environment Requirements

- Node.js 18.20+ or 20.10+
- Shopify Partner account and development store
- Required environment variables: `SHOPIFY_API_KEY`, `SHOPIFY_API_SECRET`, `SHOPIFY_APP_URL`

## Announcement Bar App Features

### Core Functionality
- **Create/Edit Announcement Bars**: Full CRUD interface with real-time preview
- **Content Options**: Title, subtitle, discount codes, call-to-action buttons
- **Design Customization**: Colors, typography, borders, positioning (top/bottom)
- **Location Targeting**: All pages, homepage, collections, products, cart, custom positioning
- **Theme Integration**: App embed (automatic) and app blocks (manual with unique IDs)

### Database Schema
The `AnnouncementBar` model includes:
- Content fields (title, subtitle, discountCode, callToAction, link)
- Design fields (colors, typography, borders, positioning)
- Location targeting (displayLocation, targetCollections, targetProducts)
- Status fields (isActive, isPublished)

### UI Implementation
- **Left Panel**: Form editor with all customization options
- **Right Panel**: Real-time sticky preview that follows scroll
- **Color System**: Polaris ColorPicker with HSVA format (decimal 0-1, not percentage)
- **Layout**: Custom CSS Grid (not Polaris Layout) for proper sticky positioning

### Theme Integration
- **App Embed**: `announcement_bars.liquid` - Automatically displays active bars based on location rules
- **App Block**: `announcement_bar.liquid` - Manual positioning using unique announcement bar ID
- **Unique IDs**: Each announcement bar has a unique ID (generated by Prisma cuid()) for custom positioning
- **API Sync**: `/api/announcement-bars` endpoint syncs data to shop metafields for theme access

### Development Notes
- Uses embedded app pattern with App Bridge React
- Session storage handled by Prisma with PostgreSQL
- Webhooks configured for app uninstall and scope updates
- Color picker values are in decimal format (0-1), not percentages (0-100)
- Form submission uses `useSubmit` hook with FormData for embedded app compatibility
- Preview component uses sticky positioning with custom CSS Grid layout
- Each announcement bar has a unique ID displayed in the UI for custom theme positioning